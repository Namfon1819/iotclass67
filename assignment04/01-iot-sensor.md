# Ingest and store real-time data from IoT sensors.
1. การเริ่มต้นเซ็นเซอร์
- เซ็นเซอร์ BMP280: ใช้วัดอุณหภูมิและความดัน ถูกเริ่มต้นในฟังก์ชัน init_BMP280()
- เซ็นเซอร์ SHT4x: ใช้วัดความชื้นและอุณหภูมิ ถูกเริ่มต้นในฟังก์ชัน init_SHT4x()
- เซ็นเซอร์ Analog: อ่านค่าจากพินที่ถูกกำหนดเป็น sensorPin
2. การเก็บข้อมูล
-ในฟังก์ชัน loop() จะมีการอ่านข้อมูลจากเซ็นเซอร์ BMP280, SHT4x และเซ็นเซอร์ Analog อย่างสม่ำเสมอ
-ใช้ bmp280.readTemperature() และ bmp280.readPressure() เพื่อดึงค่าอุณหภูมิและความดันจากเซ็นเซอร์ BMP280
-ใช้ sensor.measureLowestPrecision(temp, humid) เพื่อดึงค่าความชื้นและอุณหภูมิจากเซ็นเซอร์ SHT4x
-ใช้ analogRead(sensorPin) เพื่ออ่านค่าจากพิน Analog ที่กำหนด
3. การจัดรูปแบบและการส่งข้อมูล
- ข้อมูลจะถูกจัดรูปแบบเป็น JSON โดยใช้คลาส StaticJsonDocument และ JsonObject
ข้อมูลที่ส่งไปยัง MQTT ประกอบด้วย:
- "id": รหัสที่ไม่ซ้ำสำหรับเซ็นเซอร์
- "name": ชื่อของเซ็นเซอร์
- "place_id": รหัสที่ระบุสถานที่ของเซ็นเซอร์
- "date": วันที่และเวลาปัจจุบันที่ได้จาก NTP
- "timestamp": เวลาปัจจุบันในรูปแบบ epoch time
- "payload": ออบเจ็กต์ย่อยที่เก็บข้อมูลเซ็นเซอร์ เช่น อุณหภูมิ ความชื้น ความดัน และแสง (ค่าจากเซ็นเซอร์ Analog)
4. การส่งข้อมูลไปยัง MQTT
- ข้อมูลจะถูกแปลงเป็นรูปแบบ JSON และส่งไปยังหัวข้อ (topic) iot-frames ของ MQTT
- ฟังก์ชัน client.publish("iot-frames", jsonData) จะส่งข้อมูล JSON ที่แปลงแล้วไปยังหัวข้อที่กำหนด
  
## MQTT Topic
Topic (หัวข้อ) "iot-frames"
หัวข้อคือช่องทางในการส่งและรับข้อมูลผ่าน MQTT Broker ซึ่งลูกค้าสามารถส่งข้อมูลไปยังหัวข้อนี้ และลูกค้าอื่นสามารถสมัครสมาชิกเพื่อรับข้อมูลจากหัวข้อนี้ได้

## MQTT Payload
Payload (ข้อมูลที่ส่ง) ข้อมูล JSON ที่ถูกส่งไปยัง MQTT ประกอบด้วย
- "id": รหัสที่ไม่ซ้ำสำหรับเซ็นเซอร์
- "name": ชื่อของเซ็นเซอร์
- "place_id": รหัสที่ระบุสถานที่ของเซ็นเซอร์
- "date": วันที่และเวลาที่จัดรูปแบบแล้ว
- "timestamp": เวลาปัจจุบันในรูปแบบ epoch time
- "payload": ข้อมูลที่ได้รับจากเซ็นเซอร์ เช่น อุณหภูมิ ความชื้น ความดัน และแสง


## ESP32
- ESP32 เป็นไมโครคอนโทรลเลอร์ที่ใช้เชื่อมต่อกับเซ็นเซอร์, เชื่อมต่อ Wi-Fi, จัดการการสื่อสารผ่าน MQTT และควบคุมแถบ LED NeoPixel เพื่อแสดงสถานะการเชื่อมต่อ
- ESP32 ทำหน้าที่ต่าง ๆ เช่น เชื่อมต่อ Wi-Fi, เชื่อมต่อกับ MQTT broker, เก็บข้อมูลจากเซ็นเซอร์ และส่งข้อมูลไปยัง MQTT topic
- ฟังก์ชัน setup() ทำหน้าที่เริ่มต้น Wi-Fi, MQTT และเซ็นเซอร์ ขณะที่ฟังก์ชัน loop() ทำหน้าที่เก็บข้อมูลและส่งข้อมูลอย่างต่อเนื่อง
```cpp

```
